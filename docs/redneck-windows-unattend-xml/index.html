<!DOCTYPE html>
<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
		<link rel="stylesheet" href="/css/style.css" />
		<link href="https://fonts.googleapis.com/css?family=Lato" rel="stylesheet">
		<title>Redneck Windows Unattend.xml</title>
	</head>
	<body>

<header>
	<a href="/">
		<img src="/dan.jpg" alt="Picture of Dan Donoghue" />
	</a>
	<p>Dan Donoghue</p>
</header>
<h1><strong>Redneck Windows Unattend.xml</strong></h1>


	<nav id="TableOfContents">
  <ul>
    <li><a href="#unattendxml">Unattend.xml</a></li>
  </ul>
</nav>


<p>So I wanted a base VHD boot image for my laptop so I can quickly create a new Windows installation without having to go through the tedium of running a bunch of WIM commands. The basic idea was to create one base image setup with drivers and updates, then Sysprep that image, and then I can create a new differencing VHD backed by that base image.</p>
<p>The only downside was that the Windows Out-of-box-&ldquo;experience&rdquo; (OOBE) slowed the whole process down by asking asinine questions about privacy and stuff. I know! I&rsquo;ll automate it.</p>
<h2 id="unattendxml">Unattend.xml</h2>
<p>While playing around, I wanted to test out a few different ways of using unattend.xml but applying it when running the Sysprep command was taking too damn long. I wanted a quicker way&hellip; what if I ran Sysprep, took a snapshot, and then dumped <code>unattend.xml</code> into the VM where it&rsquo;s supposed to go? Hmm that could work.</p>
<p>Now, finding out where that XML went was a bit of a pain because Google would come up with millions of results about using it with <code>Sysprep.exe</code> or <code>setup.exe</code> or with MDT. Eventually I found a post that said that it gets saved to <code>\Windows\Panther\unattend.xml</code>. Finally, so I came up with this simple file that&rsquo;ll set the keyboard to the good old English UK layout, set the Administrator password to <code>Pa$$w0rd</code>, and auto-logon a couple of times to save having to login and watch for hours while Windows sets up the new user profile.</p>
<pre tabindex="0"><code>&lt;?xml version=&#34;1.0&#34; encoding=&#34;utf-8&#34;?&gt;
&lt;unattend xmlns=&#34;urn:schemas-microsoft-com:unattend&#34; xmlns:wcm=&#34;http://schemas.microsoft.com/WMIConfig/2002/State&#34;&gt;
    &lt;settings pass=&#34;windowsPE&#34;&gt;
        &lt;component name=&#34;Microsoft-Windows-International-Core-WinPE&#34; processorArchitecture=&#34;amd64&#34; publicKeyToken=&#34;31bf3856ad364e35&#34; language=&#34;neutral&#34; versionScope=&#34;nonSxS&#34;&gt;
            &lt;SetupUILanguage&gt;
                &lt;UILanguage&gt;en-US&lt;/UILanguage&gt;
            &lt;/SetupUILanguage&gt;
            &lt;InputLocale&gt;0809:00000809&lt;/InputLocale&gt;
            &lt;SystemLocale&gt;en-GB&lt;/SystemLocale&gt;
            &lt;UILanguage&gt;en-US&lt;/UILanguage&gt;
            &lt;UserLocale&gt;en-GB&lt;/UserLocale&gt;
        &lt;/component&gt;
        &lt;component name=&#34;Microsoft-Windows-Setup&#34; processorArchitecture=&#34;amd64&#34; publicKeyToken=&#34;31bf3856ad364e35&#34; language=&#34;neutral&#34; versionScope=&#34;nonSxS&#34;&gt;
            &lt;UserData&gt;
                &lt;ProductKey&gt;
                    &lt;Key&gt;&lt;/Key&gt;
                &lt;/ProductKey&gt;
                &lt;AcceptEula&gt;true&lt;/AcceptEula&gt;
            &lt;/UserData&gt;
        &lt;/component&gt;
    &lt;/settings&gt;
    &lt;settings pass=&#34;oobeSystem&#34;&gt;
        &lt;component name=&#34;Microsoft-Windows-International-Core&#34; processorArchitecture=&#34;amd64&#34; publicKeyToken=&#34;31bf3856ad364e35&#34; language=&#34;neutral&#34; versionScope=&#34;nonSxS&#34;&gt;
            &lt;InputLocale&gt;0809:00000809&lt;/InputLocale&gt;
            &lt;SystemLocale&gt;en-GB&lt;/SystemLocale&gt;
            &lt;UILanguage&gt;en-US&lt;/UILanguage&gt;
            &lt;UserLocale&gt;en-GB&lt;/UserLocale&gt;
        &lt;/component&gt;
        &lt;component name=&#34;Microsoft-Windows-Shell-Setup&#34; processorArchitecture=&#34;amd64&#34; publicKeyToken=&#34;31bf3856ad364e35&#34; language=&#34;neutral&#34; versionScope=&#34;nonSxS&#34;&gt;
            &lt;UserAccounts&gt;
                &lt;AdministratorPassword&gt;
                    &lt;Value&gt;UABhACQAJAB3ADAAcgBkAEEAZABtAGkAbgBpAHMAdAByAGEAdABvAHIAUABhAHMAcwB3AG8AcgBkAA==&lt;/Value&gt;
                    &lt;PlainText&gt;false&lt;/PlainText&gt;
                &lt;/AdministratorPassword&gt;
            &lt;/UserAccounts&gt;
            &lt;AutoLogon&gt;
                &lt;Username&gt;Administrator&lt;/Username&gt;
                &lt;Enabled&gt;true&lt;/Enabled&gt;
                &lt;LogonCount&gt;1&lt;/LogonCount&gt;
                &lt;Password&gt;
                    &lt;Value&gt;UABhACQAJAB3ADAAcgBkAFAAYQBzAHMAdwBvAHIAZAA=&lt;/Value&gt;
                    &lt;PlainText&gt;false&lt;/PlainText&gt;
                &lt;/Password&gt;
            &lt;/AutoLogon&gt;
            &lt;OOBE&gt;
                &lt;ProtectYourPC&gt;3&lt;/ProtectYourPC&gt;
                &lt;HideEULAPage&gt;true&lt;/HideEULAPage&gt;
                &lt;HideWirelessSetupInOOBE&gt;true&lt;/HideWirelessSetupInOOBE&gt;
            &lt;/OOBE&gt;
        &lt;/component&gt;
    &lt;/settings&gt;
    &lt;cpi:offlineImage cpi:source=&#34;wim:c:/users/dan/documents/install.wim#Windows 11 Pro&#34; xmlns:cpi=&#34;urn:schemas-microsoft-com:cpi&#34; /&gt;
&lt;/unattend&gt;
</code></pre><p>Now I can spin up a fresh copy of Windows in a couple of minutes, while only taking up ~12GB of my Surface Pro 5&rsquo;s tiny SSD no matter how many copies I make; and because the image is Sysprepped it&rsquo;s all good for fuckign about with Active Directory.</p>


		<footer>
			<ul>
				<li><a href="https://github.com/DanDonoghue">GitHub</a></li>
				<li><a href="https://uk.linkedin.com/in/daniel-donoghue-91349598">LinkedIn</a></li>
				<li><a href="/hire-me">Hire Me</a></li>
			</ul>
		</footer>
	</body>
</html>

